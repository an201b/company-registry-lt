{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card p-4">
            <h3 class="mb-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö</h3>
            
            {% if message %}
            <div class="alert alert-success">{{ message }}</div>
            {% endif %}

            <form action="/settings" method="post">
                <div class="mb-4">
                    <label class="form-label fw-bold">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–µ—Å—Ç—Ä (JAR)</label>
                    <input type="text" name="jar_url" class="form-control" 
                           value="{{ settings['jar_url'].value if settings['jar_url'] else '' }}">
                    <div class="form-text">CSV —Ñ–∞–π–ª —Å —Å–∞–π—Ç–∞ registrucentras.lt</div>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤ –ù–î–° (VMI)</label>
                    <input type="text" name="pvm_url" class="form-control" 
                           value="{{ settings['pvm_url'].value if settings['pvm_url'] else '' }}">
                    <div class="form-text">
                        CSV —Ñ–∞–π–ª —Å —Å–∞–π—Ç–∞ VMI –∏–ª–∏ data.gov.lt. <br>
                        –¢–µ–∫—É—â–∞—è –æ—à–∏–±–∫–∞ 404 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Å—ã–ª–∫—É –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é.
                        <a href="https://data.gov.lt/dataset/pridetinies-vertes-mokescio-moketoju-duomenys" target="_blank">–ù–∞–π—Ç–∏ –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É –Ω–∞ data.gov.lt</a>
                    </div>
                </div>

                <div class="d-flex justify-content-between">
                    <a href="/" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
                    <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
            
            <hr class="my-4">
            
            <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h5>
            <p>–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å (—Å —Ç–µ–∫—É—â–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏).</p>
            <button onclick="forceUpdate()" class="btn btn-warning">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ–π—á–∞—Å</button>
            <span id="updateStatus" class="ms-2 text-muted"></span>
        </div>
    </div>
</div>

<script>
async function forceUpdate() {
    const status = document.getElementById('updateStatus');
    status.innerText = "–ó–∞–ø—É—Å–∫...";
    try {
        const response = await fetch('/api/v1/force-update', { method: 'POST' });
        const data = await response.json();
        status.innerText = "‚úÖ " + data.message;
        status.classList.remove('text-muted');
        status.classList.add('text-success');
    } catch (e) {
        status.innerText = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞";
        status.classList.add('text-danger');
    }
}
</script>
{% endblock %}